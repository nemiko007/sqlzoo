# ピーク日

**テーブル構造:** `covid(name, whn, confirmed, deaths, recovered)`

感染を食い止めた（新規感染者が減少に転じた）日を特定する。
```sql
SELECT name, date, peakNewCases FROM (
  SELECT name, DATE_FORMAT(whn,'%Y-%m-%d') AS date, confirmed - LAG(confirmed, 1) OVER (PARTITION BY name ORDER BY whn) AS peakNewCases, RANK() OVER (PARTITION BY name ORDER BY confirmed - LAG(confirmed, 1) OVER (PARTITION BY name ORDER BY whn) DESC) as rank FROM covid
) AS x 
WHERE rank = 1 
ORDER BY date
```
